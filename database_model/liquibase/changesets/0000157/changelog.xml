<?xml version="1.0" encoding="UTF-8"?>

	<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd
    http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd"
	
	logicalFilePath="000157/changelog.xml">

	<changeSet author="patrick_schmitz" id="000157">

        <sql dbms="postgresql">
        <![CDATA[
        DROP VIEW "v_All_Mappings_Union";
        DROP VIEW "v_tag_2_object_list";
        DROP VIEW "v_All_Objects_Union";
        ]]>
		</sql>	

		<createView replaceIfExists="true" viewName="v_All_Objects_Union">
        <![CDATA[
    SELECT 
        sq01.id
       ,sq01.fk_object_type_id
       ,sq01.name AS name
       ,sq01.object_type_name
       ,sq01.listvalue_1
       ,sq01.listvalue_2
       ,sq01.listkey
       ,sq01.fk_client_id
       ,sq01.fk_project_id
       ,listvalue_1 || ' [' || COALESCE(COALESCE(p.name,c.name),'') || ']' AS listvalue_1_with_client_or_project
       ,listvalue_2 || ' [' || COALESCE(COALESCE(p.name,c.name),'') || ']' AS listvalue_2_with_client_or_project
       ,sq01.description
       ,sq01.detail_1_name
       ,sq01.detail_1_content
       ,sq01.detail_2_name
       ,sq01.detail_2_content
       ,sq01.detail_3_name
       ,sq01.detail_3_content
       ,sq01.detail_4_name
       ,sq01.detail_4_content
       ,sq01.detail_5_name
       ,sq01.detail_5_content
       ,sq01.fk_deleted_status_id
       ,ds.name AS deleted_status_name
    FROM (
        SELECT 
             obj.id
            ,obj.fk_object_type_id
            ,obj.NAME
            ,object_type.NAME AS object_type_name
            ,obj.NAME || ' - ' || object_type.NAME AS listvalue_1
            ,object_type.NAME || ' - ' || obj.NAME AS listvalue_2
            ,CAST(obj.id AS varchar(10)) || ';' || CAST(obj.fk_object_type_id AS varchar(10)) AS listkey
            ,CAST(NULL AS INT) AS fk_client_id
            ,obj.fk_project_id
            ,obj.description AS description
            ,NULL AS detail_1_name
            ,NULL AS detail_1_content
            ,NULL AS detail_2_name
            ,NULL AS detail_2_content
            ,NULL AS detail_3_name
            ,NULL AS detail_3_content
            ,NULL AS detail_4_name
            ,NULL AS detail_4_content
            ,NULL AS detail_5_name
            ,NULL AS detail_5_content
            ,obj.fk_deleted_status_id
        FROM sourcesystem obj
        LEFT JOIN object_type ON object_type.id = obj.fk_object_type_id
            UNION
        SELECT 
             obj.id
            ,obj.fk_object_type_id
            ,obj.NAME
            ,object_type.NAME AS object_type_name
            ,obj.NAME || ' - ' || object_type.NAME AS listvalue_1
            ,object_type.NAME || ' - ' || obj.NAME AS listvalue_2
            ,CAST(obj.id AS varchar(10)) || ';' || CAST(obj.fk_object_type_id AS varchar(10)) AS listkey
            ,CAST(NULL AS INT) AS fk_client_id
            ,obj.fk_project_id
            ,obj.description AS description
            ,NULL AS detail_1_name
            ,NULL AS detail_1_content
            ,NULL AS detail_2_name
            ,NULL AS detail_2_content
            ,NULL AS detail_3_name
            ,NULL AS detail_3_content
            ,NULL AS detail_4_name
            ,NULL AS detail_4_content
            ,NULL AS detail_5_name
            ,NULL AS detail_5_content
            ,-1 AS fk_deleted_status_id
        FROM glossary obj
        LEFT JOIN object_type ON object_type.id = obj.fk_object_type_id
            UNION
        SELECT 
             obj.id
            ,obj.fk_object_type_id
            ,obj.COMMENT
            ,object_type.NAME AS object_type_name
            ,obj.COMMENT || ' - ' || object_type.NAME AS listvalue_1
            ,object_type.NAME || ' - ' || obj.COMMENT AS listvalue_2
            ,CAST(obj.id AS varchar(10)) || ';' || CAST(obj.fk_object_type_id AS varchar(10)) AS listkey
            ,CASE
                WHEN contact_group.fk_client_id IS NOT NULL THEN contact_group.fk_client_id
                WHEN contact.fk_client_id IS NOT NULL THEN contact.fk_client_id
                ELSE NULL END AS fk_client_id
            ,CASE
                WHEN sourcesystem.fk_project_id IS NOT NULL THEN sourcesystem.fk_project_id
                WHEN glossary.fk_project_id IS NOT NULL THEN glossary.fk_project_id
                WHEN data_delivery_object.fk_project_id IS NOT NULL THEN data_delivery_object.fk_project_id
                WHEN db_database.fk_project_id IS NOT NULL THEN db_database.fk_project_id
                WHEN db_table.fk_project_id IS NOT NULL THEN db_table.fk_project_id
                WHEN db_table_field.fk_project_id IS NOT NULL THEN db_table_field.fk_project_id
                WHEN scheduling.fk_project_id IS NOT NULL THEN scheduling.fk_project_id
                WHEN keyfigure.fk_project_id IS NOT NULL THEN keyfigure.fk_project_id
                WHEN db_table_context.fk_project_id IS NOT NULL THEN db_table_context.fk_project_id
                WHEN parameter.fk_project_id IS NOT NULL THEN parameter.fk_project_id
                WHEN attribute.fk_project_id IS NOT NULL THEN attribute.fk_project_id
                WHEN data_transfer_process.fk_project_id IS NOT NULL THEN data_transfer_process.fk_project_id
                WHEN url.fk_project_id IS NOT NULL THEN url.fk_project_id
                ELSE NULL END AS fk_project_id
            ,NULL AS description
            ,NULL AS detail_1_name
            ,NULL AS detail_1_content
            ,NULL AS detail_2_name
            ,NULL AS detail_2_content
            ,NULL AS detail_3_name
            ,NULL AS detail_3_content
            ,NULL AS detail_4_name
            ,NULL AS detail_4_content
            ,NULL AS detail_5_name
            ,NULL AS detail_5_content
            ,-1 AS fk_deleted_status_id
        FROM object_comment obj
        LEFT JOIN object_type ON object_type.id = obj.fk_object_type_id
        LEFT JOIN sourcesystem ON sourcesystem.fk_object_type_id=obj.ref_fk_object_type_id AND sourcesystem.id=obj.ref_fk_object_id
        LEFT JOIN glossary ON glossary.fk_object_type_id=obj.ref_fk_object_type_id AND glossary.id=obj.ref_fk_object_id
        LEFT JOIN data_delivery_object ON data_delivery_object.fk_object_type_id=obj.ref_fk_object_type_id AND data_delivery_object.id=obj.ref_fk_object_id
        LEFT JOIN db_database ON db_database.fk_object_type_id=obj.ref_fk_object_type_id AND db_database.id=obj.ref_fk_object_id
        LEFT JOIN db_table ON db_table.fk_object_type_id=obj.ref_fk_object_type_id AND db_table.id=obj.ref_fk_object_id
        LEFT JOIN db_table_field ON db_table_field.fk_object_type_id=obj.ref_fk_object_type_id AND db_table_field.id=obj.ref_fk_object_id
        LEFT JOIN scheduling ON scheduling.fk_object_type_id=obj.ref_fk_object_type_id AND scheduling.id=obj.ref_fk_object_id
        LEFT JOIN keyfigure ON keyfigure.fk_object_type_id=obj.ref_fk_object_type_id AND keyfigure.id=obj.ref_fk_object_id
        LEFT JOIN db_table_context ON db_table_context.fk_object_type_id=obj.ref_fk_object_type_id AND db_table_context.id=obj.ref_fk_object_id
        LEFT JOIN parameter ON parameter.fk_object_type_id=obj.ref_fk_object_type_id AND parameter.id=obj.ref_fk_object_id
        LEFT JOIN attribute ON attribute.fk_object_type_id=obj.ref_fk_object_type_id AND attribute.id=obj.ref_fk_object_id
        LEFT JOIN data_transfer_process ON data_transfer_process.fk_object_type_id=obj.ref_fk_object_type_id AND data_transfer_process.id=obj.ref_fk_object_id
        LEFT JOIN contact_group ON contact_group.fk_object_type_id=obj.ref_fk_object_type_id AND contact_group.id=obj.ref_fk_object_id
        LEFT JOIN contact ON contact.fk_object_type_id=obj.ref_fk_object_type_id AND contact.id=obj.ref_fk_object_id
        LEFT JOIN url ON url.fk_object_type_id=obj.ref_fk_object_type_id AND url.id=obj.ref_fk_object_id
            UNION
        SELECT 
             obj.id
            ,obj.fk_object_type_id
            ,obj.name
            ,object_type.NAME AS object_type_name
            ,obj.name || ' - ' || object_type.NAME || ' ('|| data_delivery_type.name || ')' AS listvalue_1
            ,object_type.NAME || ' ('|| data_delivery_type.name || ')' || ' - ' || obj.name AS listvalue_2
            ,CAST(obj.id AS varchar(10)) || ';' || CAST(obj.fk_object_type_id AS varchar(10)) AS listkey
            ,CAST(NULL AS INT) AS fk_client_id
            ,obj.fk_project_id
            ,obj.description AS description
            ,'data_delivery_type.name' AS detail_1_name
            ,CAST(data_delivery_type.name AS VARCHAR(1000)) AS detail_1_content
            ,NULL AS detail_2_name
            ,NULL AS detail_2_content
            ,NULL AS detail_3_name
            ,NULL AS detail_3_content
            ,NULL AS detail_4_name
            ,NULL AS detail_4_content
            ,NULL AS detail_5_name
            ,NULL AS detail_5_content
            ,obj.fk_deleted_status_id
        FROM data_delivery_object obj
        LEFT JOIN object_type ON object_type.id = obj.fk_object_type_id
        LEFT JOIN data_delivery_type ON data_delivery_type.id=obj.fk_data_delivery_type_id
            UNION
        SELECT 
             obj.id
            ,obj.fk_object_type_id
            ,obj.name
            ,object_type.NAME AS object_type_name
            ,obj.name || ' - ' || object_type.NAME AS listvalue_1
            ,object_type.NAME || ' - ' || obj.name AS listvalue_2
            ,CAST(obj.id AS varchar(10)) || ';' || CAST(obj.fk_object_type_id AS varchar(10)) AS listkey
            ,CAST(NULL AS INT) AS fk_client_id
            ,obj.fk_project_id
            ,obj.description AS description
            ,NULL AS detail_1_name
            ,NULL AS detail_1_content
            ,NULL AS detail_2_name
            ,NULL AS detail_2_content
            ,NULL AS detail_3_name
            ,NULL AS detail_3_content
            ,NULL AS detail_4_name
            ,NULL AS detail_4_content
            ,NULL AS detail_5_name
            ,NULL AS detail_5_content
            ,obj.fk_deleted_status_id
        FROM db_database obj
        LEFT JOIN object_type ON object_type.id = obj.fk_object_type_id
            UNION
        SELECT 
             obj.id
            ,obj.fk_object_type_id
            ,obj.name
            ,object_type.NAME AS object_type_name
            ,obj.name 
                || ' - ' 
                || object_type.NAME 
                || CASE WHEN COALESCE(db_table_type.name,'')
                || COALESCE(db_table_context.name,'')<>'' THEN ' (' ELSE '' END 
                || COALESCE(db_table_type.name,'') 
                || CASE WHEN COALESCE(db_table_type.name,'')='' OR COALESCE(db_table_context.name,'')='' THEN  '' ELSE '/' END 
                || COALESCE(db_table_context.name,'') 
                || CASE WHEN COALESCE(db_table_type.name,'')
                || COALESCE(db_table_context.name,'')<>'' THEN ')' ELSE '' END 
                || CASE WHEN COALESCE(obj.location,'')<>'' THEN ' | ' || obj.location ELSE '' END                  
              AS listvalue_1
            ,object_type.NAME 
                || CASE WHEN COALESCE(db_table_type.name,'')
                || COALESCE(db_table_context.name,'')<>'' THEN ' (' ELSE '' END 
                || COALESCE(db_table_type.name,'') 
                || CASE WHEN COALESCE(db_table_type.name,'')='' OR COALESCE(db_table_context.name,'')='' THEN  '' ELSE '/' END 
                || COALESCE(db_table_context.name,'') 
                || CASE WHEN COALESCE(db_table_type.name,'')
                || COALESCE(db_table_context.name,'')<>'' THEN ')' ELSE '' END 
                || ' - ' 
                || obj.name 
              AS listvalue_2
            ,CAST(obj.id AS varchar(10)) || ';' || CAST(obj.fk_object_type_id AS varchar(10)) AS listkey
            ,CAST(NULL AS INT) AS fk_client_id
            ,obj.fk_project_id
            ,obj.description AS description
            ,'location' AS detail_1_name
            ,CAST(location AS VARCHAR(1000)) AS detail_1_content
            ,'db_table_context.name' AS detail_2_name
            ,CAST(db_table_context.name AS VARCHAR(1000)) AS detail_2_content
            ,'db_table_type.name' AS detail_3_name
            ,CAST(db_table_type.name AS VARCHAR(1000))  AS detail_3_content
            ,NULL AS detail_4_name
            ,NULL AS detail_4_content
            ,NULL AS detail_5_name
            ,NULL AS detail_5_content
            ,obj.fk_deleted_status_id
        FROM db_table obj
        LEFT JOIN object_type ON object_type.id = obj.fk_object_type_id
        LEFT JOIN db_table_type ON db_table_type.id=obj.fk_db_table_type_id
        LEFT JOIN db_table_context ON db_table_context.id=obj.fk_db_table_context_id
            UNION
        SELECT 
             obj.id
            ,obj.fk_object_type_id
            ,obj.name
            ,object_type.NAME AS object_type_name
            ,obj.name || ' (db_table: ' || COALESCE(db_table.name,'-') || ')' || ' - ' || object_type.NAME AS listvalue_1
            ,object_type.NAME || ' - ' || obj.name || ' (db_table: ' || COALESCE(db_table.name,'-') || ')' AS listvalue_2
            ,CAST(obj.id AS varchar(10)) || ';' || CAST(obj.fk_object_type_id AS varchar(10)) AS listkey
            ,CAST(NULL AS INT) AS fk_client_id
            ,obj.fk_project_id
            ,obj.description AS description
            ,'is_PrimaryKey' AS detail_1_name
            ,CAST(obj."is_PrimaryKey" AS varchar(1)) AS detail_1_content
            ,'is_BusinessKey' AS detail_2_name
            ,CAST(obj."is_BusinessKey" AS varchar(1)) AS detail_2_content
            ,'table' AS detail_3_name
            ,db_table.name AS detail_3_content
            ,'datatype' AS detail_4_name
            ,obj.datatype AS detail_4_content
            ,'source_comment' AS detail_5_name
            ,obj.source_comment AS detail_5_content
            ,obj.fk_deleted_status_id
        FROM db_table_field obj
        LEFT JOIN object_type ON object_type.id = obj.fk_object_type_id
        LEFT JOIN db_table ON db_table.id = obj.fk_db_table_id
            UNION
        SELECT 
             obj.id
            ,obj.fk_object_type_id
            ,obj.name
            ,object_type.NAME AS object_type_name
            ,obj.name || ' - ' || object_type.NAME AS listvalue_1
            ,object_type.NAME || ' - ' || obj.name AS listvalue_2
            ,CAST(obj.id AS varchar(10)) || ';' || CAST(obj.fk_object_type_id AS varchar(10)) AS listkey
            ,CAST(NULL AS INT) AS fk_client_id
            ,obj.fk_project_id
            ,obj.description AS description
            ,'scheduling_series' AS detail_1_name
            ,obj.scheduling_series AS detail_1_content
            ,'source_definition_language' AS detail_2_name
            ,obj.source_definition_language AS detail_2_content
            ,'source_comment' AS detail_3_name
            ,obj.source_comment AS detail_3_content
            ,NULL AS detail_4_name
            ,NULL AS detail_4_content
            ,NULL AS detail_5_name
            ,NULL AS detail_5_content
            ,obj.fk_deleted_status_id
        FROM scheduling obj
        LEFT JOIN object_type ON object_type.id = obj.fk_object_type_id
            UNION
        SELECT 
             obj.id
            ,obj.fk_object_type_id
            ,obj.name
            ,object_type.NAME AS object_type_name
            ,obj.name || ' - ' || object_type.NAME AS listvalue_1
            ,object_type.NAME || ' - ' || obj.name AS listvalue_2
            ,CAST(obj.id AS varchar(10)) || ';' || CAST(obj.fk_object_type_id AS varchar(10)) AS listkey
            ,CAST(NULL AS INT) AS fk_client_id
            ,obj.fk_project_id
            ,obj.description AS description
            ,'formula' AS detail_1_name
            ,obj.formula AS detail_1_content
            ,'aggregation' AS detail_2_name
            ,obj.aggregation AS detail_2_content
            ,'character' AS detail_3_name
            ,obj."character" AS detail_3_content
            ,'type' AS detail_4_name
            ,obj."type" AS detail_4_content
            ,'unit' AS detail_5_name
            ,obj.unit AS detail_5_content
            ,obj.fk_deleted_status_id
        FROM keyfigure obj
        LEFT JOIN object_type ON object_type.id = obj.fk_object_type_id
            UNION
        SELECT 
             obj.id
            ,obj.fk_object_type_id
            ,obj.name
            ,object_type.NAME AS object_type_name
            ,obj.name || ' - ' || object_type.NAME AS listvalue_1
            ,object_type.NAME || ' - ' || obj.name AS listvalue_2
            ,CAST(obj.id AS varchar(10)) || ';' || CAST(obj.fk_object_type_id AS varchar(10)) AS listkey
            ,CAST(NULL AS INT) AS fk_client_id
            ,obj.fk_project_id
            ,obj.description AS description
            ,'prefix' AS detail_1_name
            ,obj.prefix AS detail_1_content
            ,NULL AS detail_2_name
            ,NULL AS detail_2_content
            ,NULL AS detail_3_name
            ,NULL AS detail_3_content
            ,NULL AS detail_4_name
            ,NULL AS detail_4_content
            ,NULL AS detail_5_name
            ,NULL AS detail_5_content
            ,-1 AS fk_deleted_status_id
        FROM db_table_context obj
        LEFT JOIN object_type ON object_type.id = obj.fk_object_type_id
            UNION
        SELECT 
             obj.id
            ,obj.fk_object_type_id
            ,obj.name
            ,object_type.NAME AS object_type_name
            ,obj.name || ' - ' || object_type.NAME AS listvalue_1
            ,object_type.NAME || ' - ' || obj.name AS listvalue_2
            ,CAST(obj.id AS varchar(10)) || ';' || CAST(obj.fk_object_type_id AS varchar(10)) AS listkey
            ,CAST(NULL AS INT) AS fk_client_id
            ,obj.fk_project_id
            ,obj.description AS description
            ,'is_optional' AS detail_1_name
            ,CAST(obj.is_optional AS varchar(10)) AS detail_1_content
            ,'default_value' AS detail_2_name
            ,obj.default_value AS detail_2_content
            ,'datatype' AS detail_3_name
            ,obj.datatype AS detail_3_content
            ,'range' AS detail_4_name
            ,obj."range" AS detail_4_content
            ,'source_definition_language' AS detail_5_name
            ,obj.source_definition_language AS detail_5_content
            ,obj.fk_deleted_status_id
        FROM "parameter" obj
        LEFT JOIN object_type ON object_type.id = obj.fk_object_type_id
            UNION
        SELECT 
             obj.id
            ,obj.fk_object_type_id
            ,obj.name
            ,object_type.NAME AS object_type_name
            ,obj.name || ' - ' || object_type.NAME AS listvalue_1
            ,object_type.NAME || ' - ' || obj.name AS listvalue_2
            ,CAST(obj.id AS varchar(10)) || ';' || CAST(obj.fk_object_type_id AS varchar(10)) AS listkey
            ,CAST(NULL AS INT) AS fk_client_id
            ,obj.fk_project_id
            ,obj.description AS description
            ,'formula' AS detail_1_name
            ,obj.formula AS detail_1_content
            ,NULL AS detail_2_name
            ,NULL AS detail_2_content
            ,NULL AS detail_3_name
            ,NULL AS detail_3_content
            ,NULL AS detail_4_name
            ,NULL AS detail_4_content
            ,NULL AS detail_5_name
            ,NULL AS detail_5_content
            ,-1 AS fk_deleted_status_id
        FROM "attribute" obj
        LEFT JOIN object_type ON object_type.id = obj.fk_object_type_id
            UNION
        SELECT 
             obj.id
            ,obj.fk_object_type_id
            ,obj.name
            ,object_type.NAME AS object_type_name
            ,obj.name 
                || ' - ' 
                || object_type.NAME 
                || CASE WHEN COALESCE(data_transfer_type.name,'')<>'' THEN ' (' ELSE '' END 
                || COALESCE(data_transfer_type.name,'') 
                || CASE WHEN COALESCE(data_transfer_type.name,'')<>'' THEN ')' ELSE '' END 
              AS listvalue_1
            ,object_type.NAME 
                || CASE WHEN COALESCE(data_transfer_type.name,'')<>'' THEN ' (' ELSE '' END 
                || COALESCE(data_transfer_type.name,'') 
                || CASE WHEN COALESCE(data_transfer_type.name,'')<>'' THEN ')' ELSE '' END 
                || ' - ' 
                || obj.name 
              AS listvalue_2
            ,CAST(obj.id AS varchar(10)) || ';' || CAST(obj.fk_object_type_id AS varchar(10)) AS listkey
            ,CAST(NULL AS INT) AS fk_client_id
            ,obj.fk_project_id
            ,obj.description AS description
            ,'location' AS detail_1_name
            ,obj.location AS detail_1_content
            ,'source_comment' AS detail_2_name
            ,obj.source_comment AS detail_2_content
            ,NULL AS detail_3_name
            ,NULL AS detail_3_content
            ,NULL AS detail_4_name
            ,NULL AS detail_4_content
            ,NULL AS detail_5_name
            ,NULL AS detail_5_content
            ,obj.fk_deleted_status_id
        FROM data_transfer_process obj
        LEFT JOIN object_type ON object_type.id = obj.fk_object_type_id
        LEFT JOIN data_transfer_type ON data_transfer_type.id = obj.fk_data_transfer_type_id
        UNION
        SELECT 
             obj.id
            ,obj.fk_object_type_id
            ,obj.name
            ,object_type.NAME AS object_type_name
            ,obj.name || ' - ' || object_type.NAME AS listvalue_1
            ,object_type.NAME || ' - ' || obj.name AS listvalue_2
            ,CAST(obj.id AS varchar(10)) || ';' || CAST(obj.fk_object_type_id AS varchar(10)) AS listkey
            ,CAST(NULL AS INT) AS fk_client_id
            ,obj.fk_project_id
            ,obj.description AS description
            ,'url' AS detail_1_name
            ,obj.url AS detail_1_content
            ,NULL AS detail_2_name
            ,NULL AS detail_2_content
            ,NULL AS detail_3_name
            ,NULL AS detail_3_content
            ,NULL AS detail_4_name
            ,NULL AS detail_4_content
            ,NULL AS detail_5_name
            ,NULL AS detail_5_content
            ,-1 AS fk_deleted_status_id
        FROM url obj
        LEFT JOIN object_type ON object_type.id = obj.fk_object_type_id
            UNION
        SELECT 
             obj.id
            ,obj.fk_object_type_id
            ,obj.name
            ,object_type.NAME AS object_type_name
            ,obj.name || ' - ' || object_type.NAME AS listvalue_1
            ,object_type.NAME || ' - ' || obj.name AS listvalue_2
            ,CAST(obj.id AS varchar(10)) || ';' || CAST(obj.fk_object_type_id AS varchar(10)) AS listkey
            ,obj.fk_client_id
            ,NULL AS fk_project_id
            ,obj.description AS description
            ,'short_name' AS detail_1_name
            ,obj.short_name AS detail_1_content
            ,NULL AS detail_2_name
            ,NULL AS detail_2_content
            ,NULL AS detail_3_name
            ,NULL AS detail_3_content
            ,NULL AS detail_4_name
            ,NULL AS detail_4_content
            ,NULL AS detail_5_name
            ,NULL AS detail_5_content
            ,obj.fk_deleted_status_id
        FROM contact_group obj
        LEFT JOIN object_type ON object_type.id = obj.fk_object_type_id
            UNION
        SELECT 
             obj.id
            ,obj.fk_object_type_id
            ,obj.surname || ' ' || obj.givenname AS name
            ,object_type.NAME AS object_type_name
            ,obj.surname || ' ' || obj.givenname || ' - ' || object_type.NAME AS listvalue_1
            ,object_type.NAME || ' - ' || obj.surname || ' ' || obj.givenname AS listvalue_2
            ,CAST(obj.id AS varchar(10)) || ';' || CAST(obj.fk_object_type_id AS varchar(10)) AS listkey
            ,obj.fk_client_id
            ,NULL AS fk_project_id
            ,obj.description AS description
            ,'givenname' AS detail_1_name
            ,obj.givenname AS detail_1_content
            ,'surname' AS detail_2_name
            ,obj.surname AS detail_2_content
            ,NULL AS detail_3_name
            ,NULL AS detail_3_content
            ,NULL AS detail_4_name
            ,NULL AS detail_4_content
            ,NULL AS detail_5_name
            ,NULL AS detail_5_content
            ,obj.fk_deleted_status_id
      FROM contact obj
        LEFT JOIN object_type ON object_type.id = obj.fk_object_type_id
            UNION
        SELECT 
             obj.id
            ,obj.fk_object_type_id
            ,obj.name AS name
            ,object_type.NAME AS object_type_name
            ,COALESCE(attribute.name,'') || ' - ' || object_type.NAME AS listvalue_1
            ,object_type.NAME || ' - ' || COALESCE(attribute.name,'') AS listvalue_2
            ,CAST(obj.id AS varchar(10)) || ';' || CAST(obj.fk_object_type_id AS varchar(10)) AS listkey
            ,CAST(NULL AS INT) AS fk_client_id
            ,obj.fk_project_id AS fk_project_id
            ,obj.description AS description
            ,NULL AS detail_1_name
            ,NULL AS detail_1_content
            ,NULL AS detail_2_name
            ,NULL AS detail_2_content
            ,NULL AS detail_3_name
            ,NULL AS detail_3_content
            ,NULL AS detail_4_name
            ,NULL AS detail_4_content
            ,NULL AS detail_5_name
            ,NULL AS detail_5_content
            ,-1 AS fk_deleted_status_id
        FROM bracket obj
        LEFT JOIN object_type ON object_type.id = obj.fk_object_type_id
        LEFT JOIN attribute ON attribute.id = obj.fk_attribute_id 
            UNION
        SELECT 
             obj.id
            ,obj.fk_object_type_id
            ,obj."searchPattern" AS name
            ,object_type.NAME AS object_type_name
            ,COALESCE(bracket.name,'') || ' (' || obj."searchPattern" || ')' || ' - ' || object_type.NAME AS listvalue_1
            ,object_type.NAME || ' - ' || COALESCE(bracket.name,'') || ' (' || obj."searchPattern" || ')' AS listvalue_2
            ,CAST(obj.id AS varchar(10)) || ';' || CAST(obj.fk_object_type_id AS varchar(10)) AS listkey
            ,CAST(NULL AS INT) AS fk_client_id
            ,bracket.fk_project_id AS fk_project_id
            ,'searchPattern' AS description
            ,obj."searchPattern" AS detail_1_name
            ,NULL AS detail_1_content
            ,NULL AS detail_2_name
            ,NULL AS detail_2_content
            ,NULL AS detail_3_name
            ,NULL AS detail_3_content
            ,NULL AS detail_4_name
            ,NULL AS detail_4_content
            ,NULL AS detail_5_name
            ,NULL AS detail_5_content
            ,-1 AS fk_deleted_status_id
        FROM "bracket_searchPattern" obj
        LEFT JOIN object_type ON object_type.id = obj.fk_object_type_id
        LEFT JOIN bracket ON bracket.id = obj.fk_bracket_id
    ) sq01
    LEFT JOIN project p ON p.id=sq01.fk_project_id
    LEFT JOIN client c ON c.id=sq01.fk_client_id
    LEFT JOIN deleted_status ds ON ds.id = sq01.fk_deleted_status_id
    ORDER BY sq01.fk_object_type_id
    ;
        ]]>
		</createView>

        <sql dbms="postgresql">
        <![CDATA[
CREATE OR REPLACE VIEW public."v_All_Mappings_Union"
AS WITH cte_v_all_objects_union AS (
         SELECT "v_All_Objects_Union".listvalue_1,
            "v_All_Objects_Union".listvalue_2,
            "v_All_Objects_Union".name,
            "v_All_Objects_Union".object_type_name,
            "v_All_Objects_Union".listkey,
            "v_All_Objects_Union".id,
            "v_All_Objects_Union".fk_object_type_id,
            "v_All_Objects_Union".fk_client_id,
            "v_All_Objects_Union".fk_project_id
           FROM "v_All_Objects_Union"
        ), cte_map_object_2_object AS (
         SELECT map_object_2_object.ref_fk_object_id_1,
            map_object_2_object.ref_fk_object_type_id_1,
            map_object_2_object.ref_fk_object_id_2,
            map_object_2_object.ref_fk_object_type_id_2,
            map_object_2_object.id
           FROM map_object_2_object
        )
 SELECT connectiondirection,
    listvalue_1,
    listvalue_2,
    name,
    object_type_name,
    listkey,
    ref_fk_object_id_1,
    ref_fk_object_type_id_1,
    ref_fk_object_id_2,
    ref_fk_object_type_id_2,
    filter_ref_fk_object_id,
    filter_ref_fk_object_type_id,
    ref_fk_object_id_parent,
    ref_fk_object_type_id_parent,
    parentattr_name,
    parentattr_object_type_name,
    ref_fk_object_id_child,
    ref_fk_object_type_id_child,
    childattr_name,
    childattr_object_type_name,
    id,
    fk_client_id,
    fk_project_id
   FROM ( SELECT '->'::text AS connectiondirection,
            "v_All_Objects_Union".listvalue_1,
            "v_All_Objects_Union".listvalue_2,
            "v_All_Objects_Union".name,
            "v_All_Objects_Union".object_type_name,
            "v_All_Objects_Union".listkey,
            map_object_2_object.ref_fk_object_id_1,
            map_object_2_object.ref_fk_object_type_id_1,
            map_object_2_object.ref_fk_object_id_2,
            map_object_2_object.ref_fk_object_type_id_2,
            map_object_2_object.ref_fk_object_id_1 AS filter_ref_fk_object_id,
            map_object_2_object.ref_fk_object_type_id_1 AS filter_ref_fk_object_type_id,
            parent.ref_fk_object_id_parent,
            parent.ref_fk_object_type_id_parent,
            parentattr.name AS parentattr_name,
            parentattr.object_type_name AS parentattr_object_type_name,
            child.ref_fk_object_id_child,
            child.ref_fk_object_type_id_child,
            childattr.name AS childattr_name,
            childattr.object_type_name AS childattr_object_type_name,
            map_object_2_object.id,
            "v_All_Objects_Union".fk_client_id,
            "v_All_Objects_Union".fk_project_id
           FROM cte_map_object_2_object map_object_2_object
             LEFT JOIN cte_v_all_objects_union "v_All_Objects_Union" ON "v_All_Objects_Union".id = map_object_2_object.ref_fk_object_id_2 AND "v_All_Objects_Union".fk_object_type_id = map_object_2_object.ref_fk_object_type_id_2
             LEFT JOIN object_depends_on parent ON parent.ref_fk_object_id_parent = map_object_2_object.ref_fk_object_id_2 AND parent.ref_fk_object_type_id_parent = map_object_2_object.ref_fk_object_type_id_2
             LEFT JOIN cte_v_all_objects_union parentattr ON parentattr.id = parent.ref_fk_object_id_parent AND parentattr.fk_object_type_id = parent.ref_fk_object_type_id_parent
             LEFT JOIN object_depends_on child ON child.ref_fk_object_id_child = map_object_2_object.ref_fk_object_id_2 AND child.ref_fk_object_type_id_child = map_object_2_object.ref_fk_object_type_id_2
             LEFT JOIN cte_v_all_objects_union childattr ON childattr.id = child.ref_fk_object_id_parent AND childattr.fk_object_type_id = child.ref_fk_object_type_id_parent
        UNION
         SELECT '<-'::text AS connectiondirection,
            "v_All_Objects_Union".listvalue_1,
            "v_All_Objects_Union".listvalue_2,
            "v_All_Objects_Union".name,
            "v_All_Objects_Union".object_type_name,
            "v_All_Objects_Union".listkey,
            map_object_2_object.ref_fk_object_id_1,
            map_object_2_object.ref_fk_object_type_id_1,
            map_object_2_object.ref_fk_object_id_2,
            map_object_2_object.ref_fk_object_type_id_2,
            map_object_2_object.ref_fk_object_id_2 AS filter_ref_fk_object_id,
            map_object_2_object.ref_fk_object_type_id_2 AS filter_ref_fk_object_type_id,
            parent.ref_fk_object_id_parent,
            parent.ref_fk_object_type_id_parent,
            parentattr.name,
            parentattr.object_type_name,
            child.ref_fk_object_id_child,
            child.ref_fk_object_type_id_child,
            childattr.name AS childattr_name,
            childattr.object_type_name AS childattr_object_type_name,
            map_object_2_object.id,
            "v_All_Objects_Union".fk_client_id,
            "v_All_Objects_Union".fk_project_id
           FROM cte_map_object_2_object map_object_2_object
             LEFT JOIN cte_v_all_objects_union "v_All_Objects_Union" ON "v_All_Objects_Union".id = map_object_2_object.ref_fk_object_id_1 AND "v_All_Objects_Union".fk_object_type_id = map_object_2_object.ref_fk_object_type_id_1
             LEFT JOIN object_depends_on parent ON parent.ref_fk_object_id_parent = map_object_2_object.ref_fk_object_id_1 AND parent.ref_fk_object_type_id_parent = map_object_2_object.ref_fk_object_type_id_1
             LEFT JOIN cte_v_all_objects_union parentattr ON parentattr.id = parent.ref_fk_object_id_parent AND parentattr.fk_object_type_id = parent.ref_fk_object_type_id_parent
             LEFT JOIN object_depends_on child ON child.ref_fk_object_id_child = map_object_2_object.ref_fk_object_id_1 AND child.ref_fk_object_type_id_child = map_object_2_object.ref_fk_object_type_id_1
             LEFT JOIN cte_v_all_objects_union childattr ON childattr.id = child.ref_fk_object_id_parent AND childattr.fk_object_type_id = child.ref_fk_object_type_id_parent) un;
        ]]>
		</sql>	

        <sql dbms="postgresql">
        <![CDATA[
CREATE OR REPLACE VIEW public.v_tag_2_object_list
AS SELECT mo2t.id,
    mo2t.ref_fk_object_id,
    mo2t.ref_fk_object_type_id,
    vaou.object_type_name,
    vaou.name AS object_name,
    mo2t.fk_tag_id,
    tag.name AS tag_name,
    (((replace(vaou.object_type_name, '_'::text, ''::text) || '/'::text) || 'view'::text) || '&id='::text) || mo2t.ref_fk_object_id AS action,
    tag.fk_project_id,
    tag.fk_user_id,
    tag.optgroup,
    replace(vaou.object_type_name, '_'::text, ''::text) AS controllername,
    vaou.fk_project_id AS fk_project_id_from_object,
    vaou.fk_client_id AS fk_client_id_from_object
   FROM map_object_2_tag mo2t
     LEFT JOIN "v_All_Objects_Union" vaou ON 1 = 1 AND vaou.fk_object_type_id = mo2t.ref_fk_object_type_id AND vaou.id = mo2t.ref_fk_object_id
     LEFT JOIN "v_tagsOptGroup" tag ON 1 = 1 AND tag.id = mo2t.fk_tag_id
  ORDER BY tag.name, vaou.object_type_name;        
        ]]>
		</sql>	

		<comment>
		<![CDATA[
		Take over custom implementation.
		Used objects:
			v_All_Objects_Union
		Phabricator tasks:
			T392
            T420
            T587
		]]>
		</comment>
</changeSet>
</databaseChangeLog>
